# Admin Authentication System

This document outlines how to use the admin authentication system with the `public.admins` table.

## Database Setup

The system uses the `public.admins` table with the following structure:

```sql
CREATE TABLE public.admins (
  id bigint generated by default as identity not null,
  password text not null,
  name text,
  email text,
  created_at timestamp with time zone default current_timestamp not null,
  last_login timestamp with time zone,
  constraint admins_pkey primary key (id)
);
```

## Setup Instructions

1. Create the admins table in your Supabase project:

```bash
# Run the setup SQL script
psql -U postgres -d your_database_name -f setup/setup_admins_table.sql
```

2. Create a default admin:

```bash
# Using the CLI tool
node setup/create-admin.js
```

## Authentication Flow

1. **Login**: Send a POST request to `/api/auth/login` with:
   ```json
   {
     "username": "admin_id",
     "password": "admin_password"
   }
   ```

2. **Response**: You'll receive a token and user object:
   ```json
   {
     "token": "base64_token_string",
     "user": {
       "id": 1,
       "role": "admin"
     }
   }
   ```

3. **Using the Token**: Include the token in the `Authorization` header for API requests:
   ```
   Authorization: Bearer your_token_here
   ```

## Protected Endpoints

All endpoints under `/api/admin/*` are protected and require authentication.

## Adding New Admins

Only existing admins can create new admin users via the `/api/auth/admin/register` endpoint.

## Password Utilities

The system includes utilities for secure password handling:

- `hashPassword`: Securely hashes passwords using bcrypt
- `verifyPassword`: Verifies passwords against hashed versions
- `createAdmin`: Creates a new admin with a hashed password

## Development Tools

- `hash-password.js`: CLI tool to generate bcrypt hashes for passwords

## Security Notes

1. Passwords are stored as bcrypt hashes
2. The authentication token is a simple base64 encoded string - consider using JWT tokens for production
3. Make sure to set up proper database permissions and row-level security in Supabase
